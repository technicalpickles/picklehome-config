switch:
  - platform: template
    switches:
      fireplace:
        friendly_name: Fireplace
        value_template: >
           {{ is_state("media_player.fireplace_kodi", "playing") }}
        turn_on:
          # use a script, because it runs asynchronously.
          # otherwise, when alexa-controlled, might timeout waiting for it to finish
          - service: script.fireplace_on
        turn_off:
          - service: script.fireplace_off

script:
  fireplace_off:
    sequence:
      - service: media_player.turn_off
        entity_id: media_player.fireplace_kodi
      - service: light.turn_off
        entity_id: light.fireplace_backlight

  fireplace_on:
    sequence:
      - service: light.turn_on
        entity_id: light.fireplace_backlight
        data:
          rgb_color: [255,161,0]
          brightness: 144
      - service: media_player.turn_on
        entity_id: media_player.fireplace_kodi
      - service: media_player.play_media
        entity_id: media_player.fireplace_kodi
        data:
          media_content_id: !secret fireplace_media
          media_content_type: "video"
